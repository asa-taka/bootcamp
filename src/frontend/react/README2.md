---
footer: CC BY-SA Licensed | Copyright (c) 2020, Internet Initiative Japan Inc.
title: Reactでシングルページアプリケーションを書こう
description: Reactでシングルページアプリケーションを書こう
time: 2h
prior_knowledge: 特になし
---

<header-table/>

# {{$page.frontmatter.title}}

## Reactハンズオン、とりあえず動かそう

Facebook発のUIライブラリ。https://react.dev

ReactはデータとDOMの対応付けをやってくれるライブラリであり、さらにデータの更新に対して画面をリアクティブ(反応的)に更新してくれるフレームワークである。
データバインディングされたUIを実現するためのライブラリと言える。

ピンと来た人もいるかもしれないが、この後の説明はSvelteの講義でも言われていたことだと思うので、途中まで飛ばしても構わない。
一応その講義を見ていない人のためにここでも説明をしておく。

### Reactが解決してくれる課題

JavaScript基礎、DOM操作の講義でブラウザのAPIとして存在するDOM操作のメソッドを利用してDOMを操作し、それにより表示中の画面を書き換えられることは体感できたと思う。
しかし、あれで大規模なアプリを組むのは辛い。一度使ってもらったみんなにはわかってもらえると思う。
例えば次のような場合に特に辛いと思われる:

- 画面を定期的に更新が必要な場合
- データの更新対象がそもそも複雑なDOMである場合
- 更新の必要がない場合は更新したくない場合
  - 要素を作り直してしまうと `input` 要素のデータが失われてしまうなど

思われる、というのは私がそもそもDOMを操作してこういう更新系の処理を書いた経験がないため想像で書いているためだ。

複雑なDOMの例を出せば、以下のようなユーザプロフィールのリストを更新するような処理はDOM操作のAPIを利用して操作するのは辛いと思われる。
昨今のHTMLは入れ子が深く属性も山盛りである。

```html
<div class="profile-list">
  <div class="profile-container">
    <div class="profile-pict">
      <img src="...">
    </div>
    <div class="profile">
      <p>...</p>
    </div>
  </div>
  <div class="profile-container">
    <!-- ...繰り返し... -->
  </div>
<div>
```

そしてこれもあくまで実際のウェブアプリの規模で言えばほんの画面の一部を占めるコンポーネントにしかすぎず、実際の画面全体のDOMはこれの数百倍だとしても珍しい話ではない。
そこまで複雑でない業務用のアプリを作るとしても、これの数十倍のDOMにはなるだろう。

そしてその膨大なDOMに対して、変更内容に応じた要素に更新をかけるような処理をあの素朴なAPIを利用して開発する必要が出てくる。

そんなの無理に決まっているじゃないか。

### Reactを使うとどうなるか

(Virtual DOMの説明)

(一応Reconcileの説明をひとことくらいで)

Reactのコンポーネントは入力がデータで出力がVirtual DOMの関数である。
実のところちょっと前はクラスを利用していたが、その時点で関数的な思想はあったと思うので気にせず「関数的」と言おうと思う。

```js
{

}
```

みたいなデータが

### というわけで実際に動作するところを見てみよう

(カウンタプログラム)

### 機能の説明

(stateとhook)

## コンポーネントをネストさせる

コンポーネントはデータを受け取りVirtual DOMを出力する関数であり、Reactではこれをネストさせることができる。
親コンポーネントが受け取ったデータを子コンポーネントの引数として渡し、子コンポーネントが返したVirtual DOMを含んだVirtual DOMを親コンポーネントが返すのである。
見た方が早いのでやってみてくれ。

```jsx


```

子コンポーネント

## はい、ここで今回の題材の説明をします

### CRUD(+Q)操作

CRUDはReactに限らずウェブアプリ、もしくはバックエンドを含めたシステムに関する言葉。

- それぞれCREATE/READ/UPDATE/DELETE + Queryの略
  - +Qはそこまでメジャーではない言い方ではないけれど、今回はこの言い方を採用する
- 閲覧系: QUERY, READ
- 変更系: CREATE, UPDATE, DELETE

なぜこの言葉を説明するのか。大事だから。
QUERYとREADで満足しがち。そしてアプリの画面に占める面積的にはこの二つの機能がほぼ全てを占めるため、この二つが実装できればアプリはほとんど完成、と思ってしまいがち(私はそうだった)。
でもアプリ開発の難しさは残りの変更系の操作に
主管的で雑な言い方をするとアプリ全体に占める操作をこの二つに分類すると、変更系の実装は閲覧系の3-5倍くらい大変。単純に操作の種類が多いのもある。
代表的なものを挙げるとCREATEとUPDATEはそれぞれ作成フォームと更新フォーム、DELETEは削除ボタン(+確認ダイアログ)として実装される。
CREATEとUPDATEはフォームをどこに置くか、ダイアログにするか、別ページにするかで悩む。
そしてCREATEとUPDATEのフォームは似ている。似ているためコードの重複を考えると共通部分を切り分けたくなる。しかし単純に切り分けられるだろうか。

DELETEは確認ダイアログをどう出すかで悩む。DELETEボタンは小さいくせに機能が沢山詰まっている。

CRUD操作は意識しながらアプリ開発をするとそれぞれの操作に必要な実装がパターンとして見えてくる。

### TODOアプリ

TODOアプリはCRUD+Q操作を学ぶための題材として適している。

- READ: TODO表示
- QUERY: TODOフィルタリング
- CREATE: TODO作成
- UPDATE: TODO更新
- DELETE: TODO削除

そもそもアプリ開発の経験を積むためには題材が必要だけれど、その題材を決めるのも初めは難しい。
という理由で初心者にもとりあえずおすすめ。

中級者以上であっても、TODOアプリを作ればとりあえずそのフレームワークの癖や、
実践的なアプリを組む際のイメージがなんとなく掴めるため、新しいフレームワークを評価する際にも使える(と言いつつ私は使ったことはない)。

TODOアプリで手に慣らしたテクニックを応用すると複雑なアプリの組み方も少しずつ見えてくる。
次で少し(妄想の)アプリを考えてみる。

### TODOの先

例えばブログサービスを考えてみる。各ブログエントリにはコメントを書けることにする。

記事(document)とコメント(comment)の二種類のエンティティ(システム上で取り扱う「モノ」「対象物」としてのデータをこう呼ぶことがある)があるとしよう。
このブログサービス上での操作は例えばこんな感じになるかもしれない:

- 記事(document)に関する操作
  - ブログ閲覧: READ document + QUERY comment (普通のAPIならまとめて取得できると思う)
  - ブログ投稿: CREATE document
  - ブログ編集: UPDATE document
  - ブログ削除: DELETE document
- コメント(comment)に関する操作
  - コメントをブログに投稿: CREATE comment
  - コメントを編集: UPDATE comment
  - コメントを削除: DELETE comment

とても適当な例なのでなんとなくで捉えて欲しい。一般的なブログサービスを想像すればなんとなくイメージはつくと思う。
そして概ねCRUDのそれぞれの操作で必要なUIパーツ(フォームやボタン)にパターンが見出せるのも理解できると思う。
CREATEとUPDATEにはフォームが、DELETEにはボタンが使われそうだなという、そういうパターンがある。

パターンが同じなら概ね同じような実装方法が取れる。

### 今回の講義のゴール

というわけで今回の講義を通してのゴールは

- TODOアプリをCRUDを意識しながらReactで実装し、それぞれの実装パターンを身につける

以上、やっていこう。

## 

## ここから先の実践で必要になること

- サーバの用意: データの永続化に必要
  - ネットワーク越しにAPIを利用してCRUD操作を行う必要も出てくる
  - 非同期処理ができなくてはこの先生き残れない
- 公式: https://react.dev
- 認証: 社内で業務上の情報を扱うツールを作る場合は避けられない
- ルーティングライブラリを利用したマルチページ化(react-routerなど)
  - アプリ開発の世界ではURLと画面の対応付けのことを「ルーティング」と呼ぶ
  - IPルーティングとかとは違う
- NextJS
  - React公式でもプロジェクト作成の最初の選択肢はこれになっている: https://react.dev/learn/start-a-new-react-project

<credit-footer/>
